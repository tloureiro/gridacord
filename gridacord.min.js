(function(a){a.fn.gridacord=function(f){if(f===undefined){f={}}target=a(this).selector;item_margin=f.item_margin===undefined?5:f.item_margin;width=f.width===undefined?290:f.width;height=f.height===undefined?290:f.height;transition_time=f.transition_time===undefined?800:f.transition_time;if(d(target)){c(target,width,height,item_margin);e(target,width,height);b(target);a(target+" .item").hover(function(){index=a(target+" .item").index(this);grid_size=parseInt(a(target).css("width"));if(a(target+" .item").eq(index).attr("data-exp-width")!=null){exp_width=parseInt(a(target+" .item").eq(index).attr("data-exp-width"))}else{exp_width=a(target+" .item img").eq(index).width()}if(a(target+" .item").eq(index).attr("data-exp-height")!=null){exp_height=parseInt(a(target+" .item").eq(index).attr("data-exp-height"))}else{exp_height=a(target+" .item img").eq(index).height()}qt_items=a(target+" .item").size();items_per_row=Math.sqrt(qt_items);col=Math.floor(index/items_per_row);line=Math.floor(index%items_per_row);for(i=0;i<qt_items;i++){a_col=Math.floor(i/items_per_row);a_line=Math.floor(i%items_per_row);l=null;t=null;if(a_col==col){new_height=exp_height;l=0}else{new_height=(grid_size-item_margin-exp_height-2*item_margin)/(items_per_row-1)-(2*item_margin)}if(a_line==line){new_width=exp_width;t=0}else{new_width=(grid_size-item_margin-exp_width-2*item_margin)/(items_per_row-1)-(2*item_margin)}a(target+" .item").eq(i).animate({height:new_height,width:new_width},{duration:transition_time,queue:false});a(target+" .item img").eq(i).animate({left:l,top:t},{duration:transition_time,queue:false})}},function(){for(i=0;i<qt_items;i++){a(target+" .item").eq(i).animate({height:width,width:height},{duration:transition_time,queue:false});l=jQuery.data(a(target+" .item img")[i],"l");t=jQuery.data(a(target+" .item img")[i],"t");a(target+" .item img").eq(i).animate({left:l,top:t},{duration:transition_time,queue:false})}})}function c(m,k,g,h){a(m+" .item").css({width:k+"px",height:g+"px",margin:h+"px","float":"left",overflow:"hidden"});a(m+" .item img").css({position:"relative"});i=a(m+" .item").size();j=Math.sqrt(i);container_width=(k+2*h)*j+h;container_height=(g+2*h)*j+h;a(m).css({width:container_width,height:container_height,padding:h+"px 0px 0px "+h+"px"})}function e(k,h,g){a(k+" .item img").imagesLoaded(function(){a(k+" .item").each(function(){target_width=a(this).width();target_height=a(this).height();if(a(this).find("img").length==0){return true}img_width=a(this).find("img").width();img_height=a(this).find("img").height();spot_x=a(this).attr("data-spot-x");spot_y=a(this).attr("data-spot-y");if(spot_x==null){spot_x=50}if(spot_y==null){spot_y=50}l=((img_width*(spot_x/100))*-1)+(target_width/2);t=((img_height*(spot_y/100))*-1)+(target_height/2);if(l>0){l=0}else{if((l*-1)+h>img_width){l=(img_width-h)*-1}}if(t>0){t=0}else{if((t*-1)+g>img_height){t=(img_height-g)*-1}}a(this).find("img").css("left",l);jQuery.data(a(this).find("img")[0],"l",l);a(this).find("img").css("top",t);jQuery.data(a(this).find("img")[0],"t",t)})})}function d(g){i=a(g+" .item").size();j=Math.sqrt(i);if(parseInt(j)!=j){console.log("Items number must a power of 2");return false}else{return true}}function b(g){a(g+" .item").each(function(){if(a(this).attr("data-exp-width")!=null){a(this).find("img").width(a(this).attr("data-exp-width"))}if(a(this).attr("data-exp-height")!=null){a(this).find("img").height(a(this).attr("data-exp-height"))}})}}})(jQuery);
